<div class="mt-4 ml-6 mr-6">
  <div class="flex justify-content-center flex-wrap p-4 gap-4">
    <div class="inputgroup">
      <input
        [disabled]="selectedIndexerForm === undefined"
        #targetEl
        class="search-bar"
        (keyup)="showSuggestions($event, targetEl)"
        (keydown.enter)="searchProducts()"
        [(ngModel)]="searchText"
        type="text" pInputText placeholder="Search..."/>
      <p-overlayPanel #op>
        <div [style]="{'width': '40rem'}">
          <p-progressSpinner *ngIf="loadingSuggestions" styleClass="flex justify-content-center w-4rem h-4rem"
                             strokeWidth="8" fill="var(--surface-ground)"
                             animationDuration=".5s"></p-progressSpinner>
          <p-menu *ngIf="!loadingSuggestions" [style]="{'width': '40rem'}" [model]="suggestions"></p-menu>
        </div>
      </p-overlayPanel>

      <button
        [disabled]="selectedIndexerForm === undefined"
        (click)="searchProducts()"
        type="button" pButton icon="pi pi-search" styleClass="p-button-warn"></button>
      <p-dropdown
        class="ml-2"
        [disabled]="cached_indexers.length === 0"
        id="indexer-id"
        [(ngModel)]="selectedIndexerForm"
        placeholder="Select an indexer"
        [options]="cached_indexers"
        optionLabel="name"
        [filter]="true"
      ></p-dropdown>
    </div>

  </div>
  <div class="card">
    <p-table [loading]="loading"
             [value]="documents" [tableStyle]="{ 'min-width': '50rem' }">
      <ng-template pTemplate="header">
        <tr>
          <th *ngFor="let header of headers">{{ header }}</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-document>
        <tr>
          <td *ngFor="let value of document.inspector_values">
            <p>
              <container-element [ngSwitch]="value.inspector__type">
                <img
                  *ngSwitchCase="'image'"
                  class="w-9 sm:w-16rem xl:w-10rem shadow-2 block xl:block mx-auto border-round"
                  [src]="value.attribute"/>
                <a *ngSwitchCase="'link'" [href]="value.value">{{value.value}}</a>
                <app-marked-text *ngSwitchDefault [text]="(value.value | shortText) ?? ''" [searchString]="searchText">
                </app-marked-text>
              </container-element>
            </p>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td
            *ngIf="documents.length === 0"
          >
            <p>
              There are no documents found!
            </p>
          </td>
        </tr>
      </ng-template>

    </p-table>
  </div>
</div>
